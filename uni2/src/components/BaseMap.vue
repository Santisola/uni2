<template>
    <div id="mapContainer">
        <MglMap
            :accessToken="accessToken"
            :mapStyle="mapStyle"
            :center="mapCenter"
            :zoom="11"
        >
            <MglGeolocateControl position="top-right" />
            
            <MglMarker
                v-for="(alerta, index) in allAlertas" :key="index"
                :coordinates="[alerta.longitud, alerta.latitud]"
                @click="$emit('abrirResumen', alerta)"
            >
                <v-icon v-if="alerta.id_tipoalerta == 1" slot="marker">
                    <svg width="30" height="48" viewBox="0 0 30 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M25.5848 24.582C27.956 21.9717 29.4011 18.5049 29.4011 14.7006C29.4011 6.58167 22.8195 0 14.7006 0C6.58167 0 0 6.58167 0 14.7006C0 18.4227 1.38336 21.8218 3.66399 24.4117C7.33446 28.9856 12.5765 39.3244 12.5765 44.2487C12.5765 47.6036 13.6262 47.6028 14.6539 47.602L14.7005 47.602V29.4011C14.7005 29.4011 14.7005 29.4011 14.7006 29.4011L14.7006 47.602L14.7472 47.602C15.7749 47.6028 16.8246 47.6036 16.8246 44.2487C16.8246 39.3314 21.9252 29.1546 25.5848 24.582Z" fill="#44BBA4"/>
                        <g clip-path="url(#clip0_833:254)">
                        <path d="M14.7006 13.8012C12.219 13.8012 8.70056 17.6375 8.70056 20.0591C8.70056 21.1497 9.53837 21.8012 10.9424 21.8012C12.4687 21.8012 13.4765 21.0175 14.7006 21.0175C15.9352 21.0175 16.9459 21.8012 18.4587 21.8012C19.8627 21.8012 20.7006 21.1497 20.7006 20.0591C20.7006 17.6375 17.1821 13.8012 14.7006 13.8012ZM10.0981 13.4072C9.77306 12.3244 8.77181 11.6231 7.86181 11.8406C6.95181 12.0581 6.47774 13.1122 6.80274 14.195C7.12774 15.2778 8.12899 15.9791 9.039 15.7616C9.949 15.5441 10.4231 14.49 10.0981 13.4072ZM12.7456 12.7578C13.7124 12.5034 14.1962 11.1972 13.8262 9.84031C13.4562 8.48343 12.3724 7.59 11.4056 7.84437C10.4387 8.09875 9.95493 9.405 10.3249 10.7619C10.6949 12.1187 11.779 13.0125 12.7456 12.7578ZM21.539 11.8409C20.629 11.6234 19.6281 12.3247 19.3027 13.4075C18.9777 14.4903 19.4518 15.5444 20.3618 15.7619C21.2718 15.9794 22.2727 15.2781 22.5981 14.1953C22.9231 13.1125 22.449 12.0584 21.539 11.8409ZM16.6556 12.7578C17.6224 13.0122 18.7062 12.1187 19.0762 10.7619C19.4462 9.405 18.9624 8.09906 17.9956 7.84437C17.0287 7.58968 15.9449 8.48343 15.5749 9.84031C15.2049 11.1972 15.6887 12.5034 16.6556 12.7578Z" fill="white"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_833:254">
                        <rect width="16" height="16" fill="white" transform="translate(6.70056 6.80127)"/>
                        </clipPath>
                        </defs>
                    </svg>
                </v-icon>

                <v-icon v-else slot="marker">
                    <svg width="31" height="48" viewBox="0 0 31 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M26.4417 24.98C28.813 22.3697 30.2581 18.9028 30.2581 15.0985C30.2581 6.97962 23.6764 0.397949 15.5575 0.397949C7.4386 0.397949 0.856934 6.97962 0.856934 15.0985C0.856934 18.8207 2.24029 22.2198 4.52092 24.8096C8.19139 29.3836 13.4335 39.7224 13.4335 44.6467C13.4335 48.0015 14.4832 48.0008 15.5108 48L15.5575 48V29.7991C15.5575 29.7991 15.5575 29.7991 15.5575 29.7991L15.5575 48L15.6041 48C16.6318 48.0008 17.6815 48.0015 17.6815 44.6467C17.6815 39.7293 22.7822 29.5526 26.4417 24.98Z" fill="#E5446D"/>
                        <g clip-path="url(#clip0_833:209)">
                        <path d="M15.5575 14.1992C13.0759 14.1992 9.55749 18.0354 9.55749 20.457C9.55749 21.5476 10.3953 22.1992 11.7994 22.1992C13.3256 22.1992 14.3334 21.4154 15.5575 21.4154C16.7922 21.4154 17.8028 22.1992 19.3156 22.1992C20.7197 22.1992 21.5575 21.5476 21.5575 20.457C21.5575 18.0354 18.0391 14.1992 15.5575 14.1992ZM10.955 13.8051C10.63 12.7223 9.62874 12.0211 8.71874 12.2386C7.80874 12.4561 7.33468 13.5101 7.65968 14.5929C7.98468 15.6758 8.98593 16.377 9.89593 16.1595C10.8059 15.942 11.28 14.8879 10.955 13.8051ZM13.6025 13.1558C14.5694 12.9014 15.0531 11.5951 14.6831 10.2383C14.3131 8.88138 13.2294 7.98794 12.2625 8.24232C11.2956 8.49669 10.8119 9.80295 11.1819 11.1598C11.5519 12.5167 12.6359 13.4104 13.6025 13.1558ZM22.3959 12.2389C21.4859 12.0214 20.485 12.7226 20.1597 13.8054C19.8347 14.8883 20.3087 15.9423 21.2187 16.1598C22.1287 16.3773 23.1297 15.6761 23.455 14.5933C23.78 13.5104 23.3059 12.4564 22.3959 12.2389ZM17.5125 13.1558C18.4794 13.4101 19.5631 12.5167 19.9331 11.1598C20.3031 9.80295 19.8194 8.49701 18.8525 8.24232C17.8856 7.98763 16.8019 8.88138 16.4319 10.2383C16.0619 11.5951 16.5456 12.9014 17.5125 13.1558Z" fill="white"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_833:209">
                        <rect width="16" height="16" fill="white" transform="translate(7.5575 7.19922)"/>
                        </clipPath>
                        </defs>
                    </svg>
                </v-icon>
            </MglMarker>

        </MglMap>
    </div>
</template>

<script>
import Mapbox from 'mapbox-gl';
import { MglMap, MglGeolocateControl, MglMarker  } from "vue-mapbox";
import {MAPBOX_PUBLIC_TOKEN} from '../constantes/index.js';

export default {
    name: 'BaseMap',
    components: {
        MglMap,
        MglMarker,
        MglGeolocateControl 
    },
    props: {
        userLocation: {required: true},
        allAlertas: {required: true},
    },
    beforeMount() {
        this.userLocation ? this.mapCenter = {lon: this.userLocation[0], lat: this.userLocation[1]} : this.mapCenter = {lon: -58.447376624867765, lat: -34.611000283089865}
    },
    created() {
        this.mapbox = Mapbox
    },
    data() {
        return {
            accessToken: MAPBOX_PUBLIC_TOKEN,
            mapStyle: 'mapbox://styles/mapbox/streets-v11',
            mapCenter: {lon: 0, lat: 0}
        }
    },
}
</script>

<style scoped>
#mapContainer {
    width: calc(100% + 2rem);
    height: calc(100vh - 150px);
    margin: 0px -1rem;
}

.mapboxgl-marker {
    z-index: 2;
}

.mapboxgl-user-location-accuracy-circle {
    z-index: 1;
}
</style>